{% extends 'base.html.twig' %}

{% block title %}Quiz Results - Symfony & PHP Quiz Trainer{% endblock %}

{% block body %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Certification Exam Results -->
    {% if session.mode == 'certification' %}
    <div class="text-center mb-8">
        {% if session.score >= 70 %}
        <div class="mb-6">
            <div class="inline-block bg-green-100 border-4 border-green-500 rounded-full p-8 mb-4">
                <i class="fas fa-check text-6xl text-green-600"></i>
            </div>
        </div>
        <h1 class="text-4xl font-bold text-green-600 mb-2">üéâ PASSED!</h1>
        <p class="text-xl text-gray-600 mb-2">Congratulations! You passed the certification exam!</p>
        <p class="text-gray-500">Score: {{ session.score|number_format(1) }}% (Passing score: 70%)</p>
        {% else %}
        <div class="mb-6">
            <div class="inline-block bg-red-100 border-4 border-red-500 rounded-full p-8 mb-4">
                <i class="fas fa-times text-6xl text-red-600"></i>
            </div>
        </div>
        <h1 class="text-4xl font-bold text-red-600 mb-2">NOT PASSED</h1>
        <p class="text-xl text-gray-600 mb-2">Keep practicing! You need 70% to pass.</p>
        <p class="text-gray-500">Your score: {{ session.score|number_format(1) }}% (You needed: {{ (70 - session.score)|number_format(1) }}% more)</p>
        {% endif %}
        <p class="text-gray-400 text-sm mt-2">Completed on {{ session.completedAt|date('F d, Y \\a\\t H:i') }}</p>
    </div>
    {% else %}
    <!-- Regular Quiz Results Header -->
    <div class="text-center mb-8">
        {% if session.score >= 80 %}
        <div class="text-6xl mb-4">üéâ</div>
        <h1 class="text-3xl font-bold text-green-600 mb-2">Excellent Work!</h1>
        {% elseif session.score >= 60 %}
        <div class="text-6xl mb-4">üëç</div>
        <h1 class="text-3xl font-bold text-yellow-600 mb-2">Good Job!</h1>
        {% else %}
        <div class="text-6xl mb-4">üìö</div>
        <h1 class="text-3xl font-bold text-red-600 mb-2">Keep Practicing!</h1>
        {% endif %}
        <p class="text-gray-500">Quiz completed on {{ session.completedAt|date('F d, Y \\a\\t H:i') }}</p>
    </div>
    {% endif %}

    <!-- Score Card -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
            <!-- Score -->
            <div class="p-4">
                <div class="text-5xl font-bold mb-2 
                    {% if session.score >= 80 %}text-green-600
                    {% elseif session.score >= 60 %}text-yellow-600
                    {% else %}text-red-600{% endif %}">
                    {{ session.score|number_format(0) }}%
                </div>
                <div class="text-gray-500">Final Score</div>
            </div>
            
            <!-- Correct/Incorrect -->
            <div class="p-4 border-x border-gray-200">
                <div class="flex justify-center items-center space-x-6">
                    <div>
                        <div class="text-3xl font-bold text-green-600">{{ session.correctAnswers }}</div>
                        <div class="text-gray-500 text-sm">Correct</div>
                    </div>
                    <div class="text-gray-300">/</div>
                    <div>
                        <div class="text-3xl font-bold text-red-600">{{ session.incorrectAnswers }}</div>
                        <div class="text-gray-500 text-sm">Incorrect</div>
                    </div>
                </div>
            </div>
            
            <!-- Time -->
            <div class="p-4">
                <div class="text-3xl font-bold text-gray-800">{{ session.formattedTimeSpent }}</div>
                <div class="text-gray-500">Time Spent</div>
            </div>
        </div>

        <!-- Session Details -->
        <div class="mt-6 pt-6 border-t border-gray-200">
            <div class="flex flex-wrap justify-center gap-4">
                {% if session.mode == 'certification' %}
                <span class="bg-amber-100 text-amber-700 px-4 py-2 rounded-full font-semibold">
                    <i class="fas fa-certificate mr-1"></i> Certification Exam
                </span>
                {% endif %}
                <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full">
                    <i class="fas fa-list-ol mr-1"></i> {{ session.totalQuestions }} Questions
                </span>
                {% if session.category %}
                <span class="bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full">
                    <i class="fas fa-folder mr-1"></i> {{ session.category.name }}
                </span>
                {% endif %}
                {% if session.subcategory %}
                <span class="bg-purple-100 text-purple-700 px-4 py-2 rounded-full">
                    <i class="fas fa-tag mr-1"></i> {{ session.subcategory.name }}
                </span>
                {% endif %}
                {% if session.mode != 'certification' %}
                <span class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full">
                    <i class="fas fa-cog mr-1"></i> {{ session.mode|capitalize }}
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap justify-center gap-4 mb-8">
        {% if session.mode == 'certification' %}
        <a href="{{ path('quiz_certification_exam') }}" 
           class="bg-amber-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-amber-600 transition">
            <i class="fas fa-certificate mr-2"></i> {% if session.score >= 70 %}Take Another Exam{% else %}Retry Certification{% endif %}
        </a>
        {% endif %}
        <a href="{{ path('quiz_start_form') }}" 
           class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-indigo-700 transition">
            <i class="fas fa-redo mr-2"></i> Start New Quiz
        </a>
        <a href="{{ path('quiz_review', {id: session.id}) }}" 
           class="bg-white text-indigo-600 border-2 border-indigo-600 px-6 py-3 rounded-xl font-semibold hover:bg-indigo-50 transition">
            <i class="fas fa-eye mr-2"></i> Review Answers
        </a>
        <a href="{{ path('statistics_dashboard') }}" 
           class="bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:bg-gray-200 transition">
            <i class="fas fa-chart-bar mr-2"></i> View Statistics
        </a>
    </div>

    <!-- Quick Review -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gray-50 px-6 py-4 border-b">
            <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-list-check text-indigo-600 mr-2"></i> Answer Summary
            </h2>
        </div>
        <div class="divide-y divide-gray-100">
            {% for answer in answers %}
            <div class="p-4 flex items-start space-x-4 {{ answer.isCorrect ? 'bg-green-50' : 'bg-red-50' }}">
                <div class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full 
                    {{ answer.isCorrect ? 'bg-green-500' : 'bg-red-500' }} text-white font-bold">
                    {% if answer.isCorrect %}
                        <i class="fas fa-check"></i>
                    {% else %}
                        <i class="fas fa-times"></i>
                    {% endif %}
                </div>
                <div class="flex-1 min-w-0">
                    <div class="text-gray-800 font-medium mb-1 question-text">
                        {{ answer.question.text|truncate_question(1500) }}
                    </div>
                    <div class="flex items-center space-x-4 text-sm">
                        <span class="{{ answer.isCorrect ? 'text-green-600' : 'text-red-600' }}">
                            {% if answer.isCorrect %}
                                <i class="fas fa-check-circle mr-1"></i> Correct
                            {% else %}
                                <i class="fas fa-times-circle mr-1"></i> Incorrect
                            {% endif %}
                        </span>
                        <span class="text-gray-500">
                            <i class="fas fa-stopwatch mr-1"></i> {{ answer.timeSpentSeconds }}s
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
