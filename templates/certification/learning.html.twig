{% extends 'base.html.twig' %}

{% block title %}Symfony 7 Certification - Learning Guide{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .learning-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Hero Section */
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 1rem;
        padding: 3rem 2rem;
        margin-bottom: 2rem;
        text-align: center;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.5;
    }

    .hero-content {
        position: relative;
        z-index: 1;
    }

    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.875rem;
        margin-bottom: 1rem;
    }

    .hero-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.75rem;
    }

    .hero-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 500px;
        margin: 0 auto 1.5rem;
    }

    .stats-row {
        display: flex;
        justify-content: center;
        gap: 3rem;
        margin-top: 1.5rem;
    }

    .stat-item {
        text-align: center;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
    }

    .stat-label {
        font-size: 0.85rem;
        opacity: 0.8;
    }

    /* Search */
    .search-wrapper {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .search-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        font-size: 1rem;
        transition: all 0.2s;
        background: white;
    }

    .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
    }

    /* Filter Pills */
    .filter-pills {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .filter-pill {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.2s;
        color: #4b5563;
    }

    .filter-pill:hover {
        border-color: #667eea;
        background: #f9fafb;
    }

    .filter-pill.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: transparent;
        color: white;
    }

    .filter-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }

    .filter-dot.beginner { background: #22c55e; }
    .filter-dot.intermediate { background: #f59e0b; }
    .filter-dot.advanced { background: #ef4444; }

    /* Level Cards */
    .level-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        overflow: hidden;
        border: 1px solid #e5e7eb;
    }

    .level-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.25rem 1.5rem;
        cursor: pointer;
        transition: background 0.2s;
    }

    .level-header:hover {
        background: #f9fafb;
    }

    .level-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .level-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.75rem;
        font-size: 1.5rem;
    }

    .level-icon.beginner { background: rgba(34, 197, 94, 0.1); }
    .level-icon.intermediate { background: rgba(245, 158, 11, 0.1); }
    .level-icon.advanced { background: rgba(239, 68, 68, 0.1); }

    .level-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
    }

    .level-count {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .level-chevron {
        color: #9ca3af;
        transition: transform 0.3s;
    }

    .level-header.expanded .level-chevron {
        transform: rotate(180deg);
    }

    .level-content {
        display: none;
        padding: 0 1.5rem 1.5rem;
        border-top: 1px solid #e5e7eb;
    }

    .level-content.show {
        display: block;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Section Cards */
    .section-card {
        background: #f9fafb;
        border-radius: 0.75rem;
        padding: 1.25rem;
        margin-top: 1rem;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #e5e7eb;
    }

    /* Topic Cards */
    .topic-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        margin-bottom: 0.75rem;
        overflow: hidden;
        transition: all 0.2s;
    }

    .topic-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .topic-card:last-child {
        margin-bottom: 0;
    }

    .topic-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem;
        cursor: pointer;
        transition: background 0.2s;
    }

    .topic-header:hover {
        background: #f9fafb;
    }

    .topic-name {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-weight: 500;
        color: #374151;
    }

    .topic-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 0.5rem;
        color: white;
        font-size: 0.875rem;
    }

    .topic-arrow {
        color: #9ca3af;
        transition: transform 0.3s;
    }

    .topic-card.expanded .topic-arrow {
        transform: rotate(90deg);
        color: #667eea;
    }

    .topic-content {
        display: none;
        padding: 0 1rem 1rem;
    }

    .topic-content.show {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Subtopics */
    .subtopic {
        padding: 0.875rem 0;
        border-top: 1px solid #f3f4f6;
    }

    .subtopic:first-child {
        border-top: none;
        padding-top: 0;
    }

    .subtopic-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .subtopic-title::before {
        content: '';
        width: 6px;
        height: 6px;
        background: #667eea;
        border-radius: 50%;
    }

    /* Links */
    .links-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .link-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        text-decoration: none;
        transition: all 0.2s;
    }

    .link-item:hover {
        background: white;
        border-color: #667eea;
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .link-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        flex-shrink: 0;
    }

    .link-badge.doc {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
    }

    .link-badge.video {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .link-badge.code {
        background: rgba(34, 197, 94, 0.1);
        color: #22c55e;
    }

    .link-text {
        flex: 1;
        color: #4b5563;
        font-size: 0.875rem;
    }

    .link-item:hover .link-text {
        color: #1f2937;
    }

    .link-external {
        color: #9ca3af;
        opacity: 0;
        transition: opacity 0.2s;
    }

    .link-item:hover .link-external {
        opacity: 1;
    }

    /* Progress Tracker */
    .progress-tracker {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 1rem;
        padding: 1rem 1.25rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        z-index: 100;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .progress-circle {
        width: 50px;
        height: 50px;
        position: relative;
    }

    .progress-circle svg {
        transform: rotate(-90deg);
    }

    .progress-circle-bg {
        fill: none;
        stroke: #e5e7eb;
        stroke-width: 4;
    }

    .progress-circle-fill {
        fill: none;
        stroke: url(#progressGradient);
        stroke-width: 4;
        stroke-linecap: round;
        stroke-dasharray: 126;
        stroke-dashoffset: 126;
        transition: stroke-dashoffset 0.5s ease;
    }

    .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.75rem;
        font-weight: 600;
        color: #374151;
    }

    .progress-info {
        display: flex;
        flex-direction: column;
    }

    .progress-label {
        font-size: 0.75rem;
        color: #6b7280;
    }

    .progress-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: #1f2937;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero-title {
            font-size: 1.75rem;
        }

        .stats-row {
            gap: 1.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
        }

        .filter-pills {
            justify-content: center;
        }

        .progress-tracker {
            bottom: 1rem;
            right: 1rem;
            left: 1rem;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block body %}
<div class="learning-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <div class="hero-badge">
                <span>ðŸš€</span>
                <span>Symfony 7 Certification</span>
            </div>
            <h1 class="hero-title">Learning Guide</h1>
            <p class="hero-subtitle">
                All official resources to prepare and pass your Symfony certification
            </p>
            
            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-value">3</div>
                    <div class="stat-label">Levels</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ curriculum|length > 0 ? curriculum[0].sections|length + curriculum[1].sections|length + curriculum[2].sections|length : 0 }}</div>
                    <div class="stat-label">Modules</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">100+</div>
                    <div class="stat-label">Resources</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search -->
    <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" id="searchInput" placeholder="Search a topic... (Forms, Routing, Twig, DI...)">
    </div>

    <!-- Filter Pills -->
    <div class="filter-pills">
        <div class="filter-pill active" data-target="all">
            <i class="fas fa-layer-group"></i>
            <span>View All</span>
        </div>
        <div class="filter-pill" data-target="beginner">
            <span class="filter-dot beginner"></span>
            <span>Beginner</span>
        </div>
        <div class="filter-pill" data-target="intermediate">
            <span class="filter-dot intermediate"></span>
            <span>Intermediate</span>
        </div>
        <div class="filter-pill" data-target="advanced">
            <span class="filter-dot advanced"></span>
            <span>Advanced</span>
        </div>
    </div>

    <!-- Levels -->
    {% for level in curriculum %}
    <div class="level-card" data-level="{{ level.level|lower }}">
        <div class="level-header {% if loop.first %}expanded{% endif %}" onclick="toggleLevel(this)">
            <div class="level-info">
                <div class="level-icon {{ level.level|lower }}">
                    {{ level.icon }}
                </div>
                <div>
                    <div class="level-title">{{ level.level }}</div>
                    <div class="level-count">{{ level.sections|length }} modules</div>
                </div>
            </div>
            <i class="fas fa-chevron-down level-chevron"></i>
        </div>
        
        <div class="level-content {% if loop.first %}show{% endif %}">
            {% for section in level.sections %}
            <div class="section-card">
                <h3 class="section-title">
                    <i class="fas fa-book-open text-purple-500"></i>
                    {{ section.title }}
                </h3>
                
                {% for topic in section.topics %}
                <div class="topic-card">
                    <div class="topic-header" onclick="toggleTopic(this)">
                        <div class="topic-name">
                            <div class="topic-icon">
                                <i class="fas fa-bookmark"></i>
                            </div>
                            <span>{{ topic.name }}</span>
                        </div>
                        <i class="fas fa-chevron-right topic-arrow"></i>
                    </div>
                    
                    <div class="topic-content">
                        {% for subtopic in topic.subtopics %}
                        <div class="subtopic">
                            <div class="subtopic-title">{{ subtopic.title }}</div>
                            <div class="links-list">
                                {% for link in subtopic.links %}
                                <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="link-item">
                                    <span class="link-badge {{ link.type }}">
                                        {% if link.type == 'doc' %}
                                            <i class="fas fa-book"></i> Doc
                                        {% elseif link.type == 'video' %}
                                            <i class="fas fa-play-circle"></i> Video
                                        {% elseif link.type == 'code' %}
                                            <i class="fas fa-code"></i> Code
                                        {% endif %}
                                    </span>
                                    <span class="link-text">{{ link.title }}</span>
                                    <i class="fas fa-external-link-alt link-external"></i>
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Progress Tracker -->
<div class="progress-tracker">
    <div class="progress-circle">
        <svg width="50" height="50" viewBox="0 0 50 50">
            <defs>
                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#667eea"/>
                    <stop offset="100%" stop-color="#764ba2"/>
                </linearGradient>
            </defs>
            <circle class="progress-circle-bg" cx="25" cy="25" r="20"/>
            <circle class="progress-circle-fill" cx="25" cy="25" r="20" id="progressCircle"/>
        </svg>
        <span class="progress-text" id="progressPercent">0%</span>
    </div>
    <div class="progress-info">
        <span class="progress-label">Topics explored</span>
        <span class="progress-value" id="progressCount">0 / 0</span>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
// Toggle Level
function toggleLevel(header) {
    header.classList.toggle('expanded');
    header.nextElementSibling.classList.toggle('show');
}

// Toggle Topic
function toggleTopic(header) {
    const card = header.closest('.topic-card');
    card.classList.toggle('expanded');
    card.querySelector('.topic-content').classList.toggle('show');
    updateProgress();
}

// Level Filter
document.querySelectorAll('.filter-pill').forEach(pill => {
    pill.addEventListener('click', function() {
        const target = this.dataset.target;
        
        document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
        this.classList.add('active');
        
        document.querySelectorAll('.level-card').forEach(card => {
            if (target === 'all' || card.dataset.level === target) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
});

// Search
document.getElementById('searchInput').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    
    document.querySelectorAll('.topic-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        const matches = text.includes(term);
        
        card.style.display = matches ? 'block' : 'none';
        
        if (matches && term.length > 0) {
            card.classList.add('expanded');
            card.querySelector('.topic-content').classList.add('show');
            
            const levelCard = card.closest('.level-card');
            levelCard.querySelector('.level-header').classList.add('expanded');
            levelCard.querySelector('.level-content').classList.add('show');
        }
    });
    
    document.querySelectorAll('.section-card').forEach(section => {
        const visibleTopics = section.querySelectorAll('.topic-card');
        const hasVisible = Array.from(visibleTopics).some(t => window.getComputedStyle(t).display !== 'none');
        section.style.display = hasVisible || term.length === 0 ? 'block' : 'none';
    });
});

// Progress
function updateProgress() {
    const total = document.querySelectorAll('.topic-card').length;
    const expanded = document.querySelectorAll('.topic-card.expanded').length;
    const percent = Math.round((expanded / total) * 100);
    
    const circle = document.getElementById('progressCircle');
    const circumference = 2 * Math.PI * 20;
    circle.style.strokeDashoffset = circumference - (percent / 100) * circumference;
    
    document.getElementById('progressPercent').textContent = percent + '%';
    document.getElementById('progressCount').textContent = expanded + ' / ' + total;
}

updateProgress();

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === '/' && !e.target.matches('input')) {
        e.preventDefault();
        document.getElementById('searchInput').focus();
    }
    if (e.key === 'Escape') {
        document.getElementById('searchInput').value = '';
        document.getElementById('searchInput').dispatchEvent(new Event('input'));
    }
});
</script>
{% endblock %}
