{% extends 'base.html.twig' %}

{% block title %}Symfony 7 Certification - Learning Guide{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .learning-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Level Cards */
    .level-card {
        border-radius: 1rem;
        overflow: hidden;
        margin-bottom: 1.5rem;
        border: 1px solid rgba(255,255,255,0.1);
    }

    .level-header.expanded .level-chevron {
        transform: rotate(180deg);
    }

    .level-content {
        display: none;
    }

    .level-content.show {
        display: block;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Topic Cards */
    .topic-card {
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 0.75rem;
        margin-bottom: 0.75rem;
        overflow: hidden;
        transition: all 0.3s;
        background: white;
    }

    .topic-card:hover {
        border-color: rgba(99, 102, 241, 0.3);
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.1);
        transform: translateY(-1px);
    }

    .topic-card.expanded .topic-arrow {
        transform: rotate(90deg);
        color: var(--primary, #6366f1);
    }

    .topic-content {
        display: none;
    }

    .topic-content.show {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Links */
    .link-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        text-decoration: none;
        transition: all 0.25s;
        border: 1px solid transparent;
    }

    .link-item:hover {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
        border-color: rgba(99, 102, 241, 0.15);
        transform: translateX(4px);
    }

    .link-external {
        opacity: 0;
        transition: opacity 0.2s;
    }

    .link-item:hover .link-external {
        opacity: 1;
    }

    /* Progress Tracker */
    .progress-tracker {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        border-radius: 1rem;
        padding: 1rem 1.25rem;
        z-index: 100;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .progress-circle-bg {
        fill: none;
        stroke: rgba(99, 102, 241, 0.15);
        stroke-width: 4;
    }

    .progress-circle-fill {
        fill: none;
        stroke: url(#progressGradient);
        stroke-width: 4;
        stroke-linecap: round;
        stroke-dasharray: 126;
        stroke-dashoffset: 126;
        transition: stroke-dashoffset 0.5s ease;
    }

    .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.75rem;
        font-weight: 700;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .progress-tracker {
            bottom: 1rem;
            right: 1rem;
            left: 1rem;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block body %}
<div class="learning-container py-8">
    <!-- Hero Section -->
    <div class="relative rounded-2xl overflow-hidden mb-10 animate-fade-in-up">
        <div class="absolute inset-0 bg-gradient-to-br from-primary-600 via-violet-600 to-purple-700"></div>
        <div class="absolute inset-0 opacity-10">
            <svg width="100%" height="100%"><defs><pattern id="certPattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1.5" fill="white"/></pattern></defs><rect fill="url(#certPattern)" width="100%" height="100%"/></svg>
        </div>
        <!-- Floating orbs -->
        <div class="absolute top-10 right-10 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
        <div class="absolute bottom-10 left-20 w-24 h-24 bg-cyan-400/10 rounded-full blur-xl"></div>

        <div class="relative z-10 px-8 py-12 text-center">
            <div class="inline-flex items-center gap-2 bg-white/15 backdrop-blur-sm px-4 py-2 rounded-full text-sm text-white/90 mb-4">
                <span>ðŸš€</span>
                <span>Symfony 7 Certification</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-3">
                Learning Guide
            </h1>
            <p class="text-lg text-white/80 max-w-lg mx-auto mb-8">
                All official resources to prepare and pass your Symfony certification
            </p>
            
            <div class="flex justify-center gap-10">
                <div class="text-center">
                    <div class="text-3xl font-bold text-white">3</div>
                    <div class="text-sm text-white/70">Levels</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-white">{{ curriculum|length > 0 ? curriculum[0].sections|length + curriculum[1].sections|length + curriculum[2].sections|length : 0 }}</div>
                    <div class="text-sm text-white/70">Modules</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-white">100+</div>
                    <div class="text-sm text-white/70">Resources</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search -->
    <div class="relative mb-6 animate-fade-in-up stagger-1">
        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
        <input type="text" id="searchInput" placeholder="Search for a topic... (Forms, Routing, Twig, DI...)"
               class="w-full pl-12 pr-4 py-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent shadow-sm transition-all">
        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">
            Press <kbd class="font-mono">/</kbd> to search
        </div>
    </div>

    <!-- Filter Pills -->
    <div class="flex gap-3 mb-8 flex-wrap animate-fade-in-up stagger-2">
        <button class="filter-pill active inline-flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all cursor-pointer bg-gradient-to-r from-primary-500 to-violet-500 text-white shadow-md" data-target="all">
            <i class="fas fa-layer-group"></i>
            <span>View all</span>
        </button>
        <button class="filter-pill inline-flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all cursor-pointer bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 hover:border-emerald-400" data-target="beginner">
            <span class="w-2.5 h-2.5 rounded-full bg-emerald-500"></span>
            <span>Beginner</span>
        </button>
        <button class="filter-pill inline-flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all cursor-pointer bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 hover:border-amber-400" data-target="intermediate">
            <span class="w-2.5 h-2.5 rounded-full bg-amber-500"></span>
            <span>Intermediate</span>
        </button>
        <button class="filter-pill inline-flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all cursor-pointer bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700 hover:border-red-400" data-target="advanced">
            <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span>
            <span>Advanced</span>
        </button>
    </div>

    <!-- Levels -->
    {% for level in curriculum %}
    <div class="level-card card-modern animate-fade-in-up stagger-{{ loop.index + 2 }}" data-level="{{ level.level|lower }}">
        <div class="level-header flex items-center justify-between p-5 cursor-pointer hover:bg-gray-50/50 dark:hover:bg-gray-700/30 transition {% if loop.first %}expanded{% endif %}" onclick="toggleLevel(this)">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 flex items-center justify-center rounded-xl text-2xl
                    {% if level.level|lower == 'beginner' %}bg-emerald-100 dark:bg-emerald-900/30
                    {% elseif level.level|lower == 'intermediate' %}bg-amber-100 dark:bg-amber-900/30
                    {% else %}bg-red-100 dark:bg-red-900/30{% endif %}">
                    {{ level.icon }}
                </div>
                <div>
                    <div class="text-xl font-bold text-gray-900 dark:text-white">{{ level.level }}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">{{ level.sections|length }} modules</div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="hidden sm:inline-flex items-center gap-1 text-xs font-medium px-3 py-1 rounded-full
                    {% if level.level|lower == 'beginner' %}bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400
                    {% elseif level.level|lower == 'intermediate' %}bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400
                    {% else %}bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400{% endif %}">
                    {% if level.level|lower == 'beginner' %}Fundamentals{% elseif level.level|lower == 'intermediate' %}Practice{% else %}Expert{% endif %}
                </span>
                <i class="fas fa-chevron-down level-chevron text-gray-400 transition-transform duration-300"></i>
            </div>
        </div>
        
        <div class="level-content {% if loop.first %}show{% endif %} px-5 pb-5 border-t border-gray-100 dark:border-gray-700/50">
            {% for section in level.sections %}
            <div class="mt-5 bg-gray-50/80 dark:bg-gray-800/50 rounded-xl p-5">
                <h3 class="flex items-center gap-3 text-base font-bold text-gray-800 dark:text-gray-200 mb-4 pb-3 border-b border-gray-200 dark:border-gray-700">
                    <span class="w-8 h-8 flex items-center justify-center bg-gradient-to-br from-primary-500 to-violet-500 rounded-lg text-white text-sm">
                        <i class="fas fa-book-open"></i>
                    </span>
                    {{ section.title }}
                </h3>
                
                {% for topic in section.topics %}
                <div class="topic-card">
                    <div class="topic-header flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/30 transition" onclick="toggleTopic(this)">
                        <div class="flex items-center gap-3">
                            <div class="w-9 h-9 flex items-center justify-center bg-gradient-to-br from-primary-500 to-violet-500 rounded-lg text-white text-sm">
                                <i class="fas fa-bookmark"></i>
                            </div>
                            <span class="font-medium text-gray-800 dark:text-gray-200">{{ topic.name }}</span>
                        </div>
                        <i class="fas fa-chevron-right topic-arrow text-gray-400 transition-transform duration-300 text-sm"></i>
                    </div>
                    
                    <div class="topic-content px-4 pb-4">
                        {% for subtopic in topic.subtopics %}
                        <div class="py-3 {{ not loop.first ? 'border-t border-gray-100 dark:border-gray-700/50' : '' }}">
                            <div class="flex items-center gap-2 text-sm font-semibold text-primary-600 dark:text-primary-400 mb-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-primary-500"></span>
                                {{ subtopic.title }}
                            </div>
                            <div class="flex flex-col gap-2">
                                {% for link in subtopic.links %}
                                <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="link-item group">
                                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded text-[0.65rem] font-bold uppercase tracking-wider flex-shrink-0
                                        {% if link.type == 'doc' %}bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400
                                        {% elseif link.type == 'video' %}bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400
                                        {% elseif link.type == 'code' %}bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400
                                        {% endif %}">
                                        {% if link.type == 'doc' %}<i class="fas fa-book"></i> Doc
                                        {% elseif link.type == 'video' %}<i class="fas fa-play-circle"></i> Video
                                        {% elseif link.type == 'code' %}<i class="fas fa-code"></i> Code
                                        {% endif %}
                                    </span>
                                    <span class="flex-1 text-sm text-gray-600 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white transition-colors">{{ link.title }}</span>
                                    <i class="fas fa-external-link-alt link-external text-gray-400 text-xs"></i>
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Progress Tracker -->
<div class="progress-tracker glass shadow-glass">
    <div class="relative w-[50px] h-[50px]">
        <svg width="50" height="50" viewBox="0 0 50 50" style="transform: rotate(-90deg)">
            <defs>
                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#6366f1"/>
                    <stop offset="100%" stop-color="#8b5cf6"/>
                </linearGradient>
            </defs>
            <circle class="progress-circle-bg" cx="25" cy="25" r="20"/>
            <circle class="progress-circle-fill" cx="25" cy="25" r="20" id="progressCircle"/>
        </svg>
        <span class="progress-text text-gray-800 dark:text-white" id="progressPercent">0%</span>
    </div>
    <div class="flex flex-col">
        <span class="text-xs text-gray-500 dark:text-gray-400">Topics explored</span>
        <span class="text-sm font-bold text-gray-900 dark:text-white" id="progressCount">0 / 0</span>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
// Toggle Level
function toggleLevel(header) {
    header.classList.toggle('expanded');
    header.nextElementSibling.classList.toggle('show');
}

// Toggle Topic
function toggleTopic(header) {
    const card = header.closest('.topic-card');
    card.classList.toggle('expanded');
    card.querySelector('.topic-content').classList.toggle('show');
    updateProgress();
}

// Level Filter
document.querySelectorAll('.filter-pill').forEach(pill => {
    pill.addEventListener('click', function() {
        const target = this.dataset.target;
        
        document.querySelectorAll('.filter-pill').forEach(p => {
            p.classList.remove('active');
            p.className = p.className.replace(/bg-gradient-to-r from-primary-500 to-violet-500 text-white shadow-md/g, '');
            if (!p.classList.contains('bg-white')) {
                p.classList.add('bg-white', 'dark:bg-gray-800', 'text-gray-600', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-700');
            }
        });
        
        this.classList.add('active');
        this.classList.remove('bg-white', 'dark:bg-gray-800', 'text-gray-600', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-700');
        this.classList.add('bg-gradient-to-r', 'from-primary-500', 'to-violet-500', 'text-white', 'shadow-md');
        
        document.querySelectorAll('.level-card').forEach(card => {
            if (target === 'all' || card.dataset.level === target) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
});

// Search
document.getElementById('searchInput').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    
    document.querySelectorAll('.topic-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        const matches = text.includes(term);
        
        card.style.display = matches ? 'block' : 'none';
        
        if (matches && term.length > 0) {
            card.classList.add('expanded');
            card.querySelector('.topic-content').classList.add('show');
            
            const levelCard = card.closest('.level-card');
            levelCard.querySelector('.level-header').classList.add('expanded');
            levelCard.querySelector('.level-content').classList.add('show');
        }
    });
    
    document.querySelectorAll('.level-content > div').forEach(section => {
        const visibleTopics = section.querySelectorAll('.topic-card');
        const hasVisible = Array.from(visibleTopics).some(t => window.getComputedStyle(t).display !== 'none');
        section.style.display = hasVisible || term.length === 0 ? 'block' : 'none';
    });
});

// Progress
function updateProgress() {
    const total = document.querySelectorAll('.topic-card').length;
    const expanded = document.querySelectorAll('.topic-card.expanded').length;
    const percent = Math.round((expanded / total) * 100);
    
    const circle = document.getElementById('progressCircle');
    const circumference = 2 * Math.PI * 20;
    circle.style.strokeDashoffset = circumference - (percent / 100) * circumference;
    
    document.getElementById('progressPercent').textContent = percent + '%';
    document.getElementById('progressCount').textContent = expanded + ' / ' + total;
}

updateProgress();

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === '/' && !e.target.matches('input')) {
        e.preventDefault();
        document.getElementById('searchInput').focus();
    }
    if (e.key === 'Escape') {
        document.getElementById('searchInput').value = '';
        document.getElementById('searchInput').dispatchEvent(new Event('input'));
        document.getElementById('searchInput').blur();
    }
});
</script>
{% endblock %}
