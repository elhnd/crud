{% extends 'base.html.twig' %}

{% block title %}Weak Areas - Quiz Trainer{% endblock %}

{% block body %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8 animate-fade-in-up">
        <h1 class="text-2xl font-extrabold text-gray-800 flex items-center gap-2">
            <span class="w-10 h-10 bg-gradient-to-br from-red-500 to-rose-500 rounded-xl flex items-center justify-center text-white shadow-lg shadow-red-500/20">
                <i class="fas fa-exclamation-triangle text-sm"></i>
            </span>
            Areas to Improve
        </h1>
        <p class="text-gray-400 text-sm mt-1">Focus on these topics to improve your score</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Weak Areas -->
        <div class="card-modern overflow-hidden animate-fade-in-up stagger-1">
            <div class="bg-red-50/80 px-5 py-3 border-b border-red-100">
                <h2 class="text-base font-bold text-red-700 flex items-center gap-2">
                    <i class="fas fa-chart-line"></i> Weak Areas
                </h2>
                <p class="text-red-500 text-xs">Subcategories with less than 70% success rate</p>
            </div>
            <div class="p-5 max-h-[28rem] overflow-y-auto">
                {% if weakAreas|length > 0 %}
                <div class="space-y-3">
                    {% for area in weakAreas %}
                    <div class="p-4 bg-red-50/50 rounded-xl border border-red-100">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="bg-red-200 text-red-700 px-2 py-0.5 rounded-lg text-xs font-bold uppercase">{{ area.type }}</span>
                                <span class="font-medium text-gray-800 text-sm">{{ area.name }}</span>
                            </div>
                            <span class="text-red-500 font-bold text-sm">{{ area.averageScore|number_format(1) }}%</span>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-400">{{ area.totalAttempts }} attempts</span>
                            <div class="flex items-center gap-2">
                                {% if area.documentationUrl %}
                                <a href="{{ area.documentationUrl }}" target="_blank" rel="noopener noreferrer"
                                   class="text-primary-500 hover:text-primary-700 font-medium transition">
                                    <i class="fas fa-book mr-0.5"></i>Docs
                                </a>
                                {% endif %}
                                <a href="{{ path('quiz_start_form') }}?subcategory={{ area.subcategoryId }}" 
                                   class="text-red-500 hover:text-red-700 font-bold transition">
                                    Practice <i class="fas fa-arrow-right ml-0.5"></i>
                                </a>
                            </div>
                        </div>
                        <div class="mt-2 w-full bg-red-100 rounded-full h-1.5">
                            <div class="bg-red-400 h-1.5 rounded-full transition-all" style="width: {{ area.averageScore }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-10">
                    <div class="text-5xl mb-3">üèÜ</div>
                    <h3 class="text-lg font-bold text-gray-700 mb-1">Excellent!</h3>
                    <p class="text-gray-400 text-sm">No weak areas. Keep it up!</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Most Failed Questions -->
        <div class="card-modern overflow-hidden animate-fade-in-up stagger-2">
            <div class="bg-amber-50/80 px-5 py-3 border-b border-amber-100">
                <h2 class="text-base font-bold text-amber-700 flex items-center gap-2">
                    <i class="fas fa-times-circle"></i> Most Failed Questions
                </h2>
                <p class="text-amber-500 text-xs">Questions you fail most often</p>
            </div>
            <div class="p-5 max-h-[28rem] overflow-y-auto">
                {% if mostFailedQuestions|length > 0 %}
                <div class="space-y-3">
                    {% for question in mostFailedQuestions %}
                    <a href="{{ path('statistics_question_detail', {id: question.questionId, backUrl: path('statistics_weak_areas')}) }}" 
                       class="block p-4 bg-amber-50/50 rounded-xl border border-amber-100 hover:border-amber-300 hover:bg-amber-50 transition-all group">
                        <div class="text-gray-700 font-medium text-sm mb-2 question-text line-clamp-2">
                            {{ question.questionText|truncate_question(20000) }}
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-amber-600">
                                <i class="fas fa-times mr-0.5"></i>
                                Failed {{ question.wrongCount }} / {{ question.totalAttempts }} times
                                ({{ question.failureRate|number_format(0) }}%)
                            </span>
                            <span class="text-amber-400 group-hover:text-amber-600 transition">
                                <i class="fas fa-chevron-right"></i>
                            </span>
                        </div>
                        <div class="mt-2 w-full bg-amber-100 rounded-full h-1.5">
                            <div class="bg-amber-400 h-1.5 rounded-full" style="width: {{ question.failureRate }}%"></div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-10">
                    <div class="text-5xl mb-3">‚úÖ</div>
                    <h3 class="text-lg font-bold text-gray-700 mb-1">Perfect!</h3>
                    <p class="text-gray-400 text-sm">No failed questions yet.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tips -->
    <div class="mt-8 card-modern p-6 bg-gradient-to-br from-primary-50 to-cyan-50 border-primary-100 animate-fade-in-up">
        <h3 class="text-base font-bold text-primary-800 mb-4 flex items-center gap-2">
            <i class="fas fa-lightbulb text-amber-500"></i> Improvement Tips
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-book text-primary-500 text-sm"></i>
                </div>
                <div>
                    <h4 class="font-bold text-primary-800 text-sm">Documentation</h4>
                    <p class="text-primary-600 text-xs">Review the official Symfony and PHP documentation.</p>
                </div>
            </div>
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-repeat text-primary-500 text-sm"></i>
                </div>
                <div>
                    <h4 class="font-bold text-primary-800 text-sm">Regular Practice</h4>
                    <p class="text-primary-600 text-xs">Take targeted quizzes on your weak areas.</p>
                </div>
            </div>
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-code text-primary-500 text-sm"></i>
                </div>
                <div>
                    <h4 class="font-bold text-primary-800 text-sm">Code Practice</h4>
                    <p class="text-primary-600 text-xs">Create projects with difficult concepts.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="mt-8 flex justify-center gap-3 animate-fade-in-up">
        <a href="{{ path('quiz_start_form') }}" 
           class="bg-gradient-to-r from-primary-500 to-primary-600 text-white px-5 py-3 rounded-xl font-bold text-sm hover:shadow-lg hover:shadow-primary-500/25 hover:-translate-y-0.5 transition-all flex items-center gap-2">
            <i class="fas fa-play"></i> Practice les Points Faibles
        </a>
        <a href="{{ path('statistics_dashboard') }}" 
           class="bg-gray-100 text-gray-600 px-5 py-3 rounded-xl font-bold text-sm hover:bg-gray-200 hover:-translate-y-0.5 transition-all flex items-center gap-2">
            <i class="fas fa-chart-bar"></i> Dashboard
        </a>
    </div>
</div>
{% endblock %}
